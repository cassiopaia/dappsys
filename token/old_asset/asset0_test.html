<!DOCTYPE html><html lang="en"><head><title>token/old_asset/asset0_test</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="token/old_asset/asset0_test"><meta name="groc-project-path" content="src/sol/token/old_asset/asset0_test.sol"><meta name="groc-github-url" content="https://github.com/NexusDevelopment/dappsys"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/NexusDevelopment/dappsys/blob/master/src/sol/token/old_asset/asset0_test.sol">src/sol/token/old_asset/asset0_test.sol</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> <span class="hljs-string">'dapple/test.sol'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'asset/asset0.sol'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'auth/auth_test.sol'</span>;

contract helper {
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">do_transfer</span>(<span class="hljs-params"> DSAsset0 a, address to, uint amount </span>) <span class="hljs-title">returns</span> (<span class="hljs-params">bool</span>) </span>{
        <span class="hljs-keyword">return</span> a.transfer(to, amount);
    }
}

contract DSAsset0Test is Test {
    DSAsset0 A;
    helper h;
    address bob;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setUp</span>(<span class="hljs-params"></span>) </span>{
        h = <span class="hljs-keyword">new</span> helper();
        bob = address(<span class="hljs-number">0x1</span>);
        <span class="hljs-keyword">var</span> _db = <span class="hljs-keyword">new</span> DSBalanceDB();
        _db.add_balance( me , <span class="hljs-number">1000</span> );
        A = <span class="hljs-keyword">new</span> DSAsset0Impl( _db );
        _db._ds_update_authority( DSAuthority(A), <span class="hljs-number">0</span> );
        <span class="hljs-keyword">var</span> (bal, ok) = A.get_balance(me);
        assertTrue( ok );
        assertTrue( bal == uint(<span class="hljs-number">1000</span>) );
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testTransfer</span>(<span class="hljs-params"></span>) </span>{
        assertFalse( h.do_transfer(A, address(h), <span class="hljs-number">100</span>) );
        <span class="hljs-keyword">var</span> (bal, ok) = A.get_balance(address(h));
        assertEq( bal, <span class="hljs-number">0</span> );
        A.transfer(address(h), <span class="hljs-number">100</span>);
        (bal, ok) = A.get_balance(address(h));
        assertEq( bal, <span class="hljs-number">100</span> );
        h.do_transfer(A, address(<span class="hljs-number">0x42</span>), <span class="hljs-number">100</span>);
        assertEq( bal, <span class="hljs-number">100</span> );
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">testSwapDB</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> old_db = DSAsset0Impl(A).db();
        <span class="hljs-keyword">var</span> new_db = <span class="hljs-keyword">new</span> DSBalanceDB();
        new_db._ds_update_authority( address(A), <span class="hljs-number">0</span> );
        A.swap_db( new_db, DSAuthority(<span class="hljs-keyword">this</span>), <span class="hljs-number">0</span> );
        old_db.add_balance( me, <span class="hljs-number">500</span> );
        <span class="hljs-keyword">var</span> (bal, ok) = old_db.get_balance( me );
        assertTrue(bal==<span class="hljs-number">1500</span>, <span class="hljs-string">"didn't gain authority of old db"</span>);
    }
}</div></div></div></div></body></html>